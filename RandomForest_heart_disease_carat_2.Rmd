---
title: "Random Forest"
output: html_document
date: "2023-07-06"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
options(repos = c(CRAN = "https://cran.rstudio.com"))
library(caret)
library(boot)
library(tidymodels)
library(lindia)
library(car)
library(haven)
library(htmltools)
library(tidyverse)
library(dplyr)
library(fastDummies)
library(nnet)
library(randomForest)
library(gridExtra)
library(AppliedPredictiveModeling)
library("ggplot2")

#data read
data<- read.csv('C:/Users/amybr/OneDrive/Desktop/dataset_heart.csv')

#data observations
head(data)
summary(data)
str(data)
any(is.na(data))
unique(data$heart.disease)
data$heart.disease<- as.factor(data$heart.disease)
data1=data
data1$thal[data1$thal== 3]<-"normal"
data1$thal[data1$thal== 6]<-"fixed defect"
data1$thal[data1$thal== 7]<-"reversible defect"
data1$thal<- as.factor(data1$thal)


# boxplot and scatter plot
boxplot(data1)


#transparentTheme(trans = .4)
#featurePlot(x = data[, 1:13], 
#            y = data$heart.disease, 
#            plot = "pairs",
            ## Add a key at the top
#            auto.key = list(columns = 13))


#hist(data1$major.vessels, main = "Histogram")
#boxplot(data1$major.vessels, main = "Boxplot")
#qqnorm(data1$major.vessels, main = "Normal Q-Q plot")

#remove extrem outlier
data1 = data1[data1$serum.cholestoral != "564", ]

#rerun boxplot
boxplot(data1)
```

## Data split on target (heart.disease) on data

```{r, warning=FALSE}
set.seed(123)
split <- createDataPartition(data1$heart.disease, p = 0.7, list = FALSE)
train <- data1[split, ]
test <- data1[-split, ]

```

```{r}
#train default model
set.seed(123)
fit_rf <- train(heart.disease~.,
    data = train,
    method = "rf",
    importance = TRUE)
print(fit_rf)
```
```{r}
#train final model
set.seed(123)
fit_rf2 <- train(heart.disease~.,
    data = train,
    method = "rf",
    tuneGrid = tuneGrid,
    importance = TRUE,
    nodesize = 14,
    ntree = 200,
    maxnodes = 8)
print(fit_rf2)
```